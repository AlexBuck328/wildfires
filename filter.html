<!DOCTYPE html>
<html>

<head>

    <meta charset='utf-8' />
    <title>FIRE</title>
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Helvetica Neue', Helvetica, Arial, Sans-serif;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        h1 {
            font-size: 20px;
            line-height: 30px;
        }

        h2 {
            font-size: 14px;
            line-height: 20px;
            margin-bottom: 10px;
        }

        a {
            text-decoration: none;
            color: #2dc4b2;
        }

        #console {
            position: absolute;
            width: 240px;
            margin: 10px;
            padding: 10px 20px;
            background-color: white;
        }

        .session {
            margin-bottom: 20px;
        }

        .row {
            height: 12px;
            width: 100%;
        }

        .colors {
            background: linear-gradient(to right, #2dc4b2, #3bb3c3, #669ec4, #8b88b6, #a2719b, #aa5e79);
            margin-bottom: 5px;
        }

        .label {
            width: 15%;
            display: inline-block;
            text-align: center;
        }
    </style>
</head>

<body>
    <div id='map'></div>
    <div id='console'>
        <h1>Motor vehicle collisions</h1>
        <p>Data: <a href='https://data.cityofnewyork.us/Public-Safety/NYPD-Motor-Vehicle-Collisions/h9gi-nx95'>Motor
                vehicle
                collision injuries and deaths</a> in NYC, Jan 2016</p>
        <div class='session'>
            <h2>Casualty</h2>
            <div class='row colors'>
            </div>
            <div class='row labels'>
                <div class='label'>0</div>
                <div class='label'>1</div>
                <div class='label'>2</div>
                <div class='label'>3</div>
                <div class='label'>4</div>
                <div class='label'>5+</div>
            </div>
        </div>
        <div class='session' id='sliderbar'>
            <h2>Year: <label id='active-year'>2019</label></h2>
            <input id='slider' class='row' type='range' min='0' max='43' step='1' value='43' />
        </div>
        <div class='session'>
            <h2>Day of the week</h2>
            <div class='row' id='filters'>
                <input id='all' type='radio' name='toggle' value='all' checked='checked'>
                <label for='all'>All</label>
                <input id='weekday' type='radio' name='toggle' value='weekday'>
                <label for='weekday'>Weekday</label>
                <input id='weekend' type='radio' name='toggle' value='weekend'>
                <label for='weekend'>Weekend</label>
            </div>
        </div>
    </div>
</body>

<script src='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js'></script>
<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>

<script>
    // Access Token
    mapboxgl.accessToken =
        'pk.eyJ1IjoiYWxleGJ1Y2szMjgiLCJhIjoiY2szcDZsdmFsMW9rbDNubjMydm9rNGJpMyJ9.05szss9EHEoVBbGYajbPZA';

    // Map!!!
    var map = new mapboxgl.Map({
        container: 'map', // container element id
        style: 'mapbox://styles/mapbox/light-v10',
        center: [-109.4125, 41.4376], // initial map center in [lon, lat]
        zoom: 4.66
    });

    var years = [
        1976,
        1977,
        1978,
        1979,
        1980,
        1981,
        1982,
        1983,
        1984,
        1985,
        1986,
        1987,
        1988,
        1989,
        1990,
        1991,
        1992,
        1993,
        1994,
        1995,
        1996,
        1997,
        1998,
        1999,
        2000,
        2001,
        2002,
        2003,
        2004,
        2005,
        2006,
        2007,
        2008,
        2009,
        2010,
        2011,
        2012,
        2013,
        2014,
        2015,
        2016,
        2017,
        2018,
        2019
    ]

    map.on('load', function () {
        //    var filterYear = ['==', 'year', year]
        var filterYear = ['==', ['number', ['get', 'year']], 2019];
        var filterMonth = ['!=', ['string', ['get', 'month']], 'placeholder'];

        d3.json(
            // 'rawData/collisions1601.geojson',
            // 'rawData/classD.geojson',
            'data/bothDatesClean.geojson',
            function (err, data) {
                if (err) throw err;

                // Create a month property value based on time
                // used to filter against.
                data.features = data.features.map(function (d) {
                    d.properties.month = new Date(d.properties.IgntDate).getMonth();
                    return d;
                });

                // Create a year property value based on IgntDate (time)
                // used to filter against.
                data.features = data.features.map(function (d) {
                    d.properties.year = new Date(d.properties.IgntDate)
                        .getFullYear();
                    return d;
                });

                map.addSource('fires', {
                    type: 'geojson',
                    data: data
                });

                console.log(data)

                map.addLayer({
                    id: 'firePolys',
                    type: 'fill',
                    source: 'fires',
                    paint: {
                        'fill-color': [
                            'interpolate',
                            ['linear'],
                            ['number', ['get', 'Acres']], // 'Casualty'
                            900, '#FCA107',
                            900000, '#7F3121'
                        ],
                        'fill-opacity': 0.8
                    },
                    filter: ['==', ['number', ['get', 'year']], 2019] // 'Hour' 12
                });
                // SLIDER
                document.getElementById('slider').addEventListener('input', function (e) {
                    var year = parseInt(e.target.value, 10);


                    data.features = data.features.map(function (d) {
                       year =  d.properties.year
                       console.log(year)
                    });
                    // update the map
                    filterYear = ['==', ['number', ['get', 'year']], year];
                    map.setFilter('firePolys', ['all', filterYear, filterMonth]);

                    // update text in the UI
                    document.getElementById('active-year').innerText = year;
                });


                //    document.getElementById('slider').addEventListener('input', function (e) {
                //        var hour = parseInt(e.target.value);
                //        // update the map
                //        filterHour = ['==', ['number', ['get', 'Hour']], hour];
                //        map.setFilter('collisions', ['all', filterHour, filterDay]);


                // converting 0-23 hour to AMPM format
                //        var ampm = hour >= 12 ? 'PM' : 'AM';
                //        var hour12 = hour % 12 ? hour % 12 : 12;

                // update text in the UI
                //        document.getElementById('active-hour').innerText = hour12 + ampm;
                //    });




                // RADIO BUTTONS
                //            document
                //                .getElementById('filters')
                //                .addEventListener('change', function (e) {
                //                    var month = (e.target.value, 10);
                //                    // update the map filter
                //                    if (year === 'all') {
                //                        filterYear = ['!=', ['string', ['get', 'year']], 'placeholder'];
                //                    } else if (year === 'weekday') {
                //                        filterYear = [
                //                            'match',
                //                            ['get', 'Day'],
                //                            ['Sat', 'Sun'],
                //                            false,
                //                            true
                //                        ];
                //                    } else if (Month === 'weekend') {
                //                        filterMonth = [
                //                            'match',
                //                            ['get', 'Day'],
                //                            ['Sat', 'Sun'],
                //                            true,
                //                            false
                //                        ];
                //                    } else {
                //                        console.log('error');
                //                    }
                //                    map.setFilter('collisions', ['all', filterMonth, filterYear]);
                //                });




                //    document
                //        .getElementById('filters')
                //        .addEventListener('change', function (e) {
                //            var day = e.target.value;
                //            // update the map filter
                //            if (day === 'all') {
                //                filterDay = ['!=', ['string', ['get', 'Day']], 'placeholder'];
                //            } else if (day === 'weekday') {
                //                filterDay = [
                //                    'match',
                //                    ['get', 'Day'],
                //                    ['Sat', 'Sun'],
                //                    false,
                //                    true
                //                ];
                //            } else if (day === 'weekend') {
                //                filterDay = [
                //                    'match',
                //                   ['get', 'Day'],
                //                    ['Sat', 'Sun'],
                //                    true,
                //                    false
                //                ];
                //            } else {
                //                console.log('error');
                //            }
                //            map.setFilter('collisions', ['all', filterHour, filterDay]);
                //        });
            });
    });
</script>

</html>