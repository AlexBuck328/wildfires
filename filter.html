<!DOCTYPE html>
<html>

<head>

    <meta charset='utf-8' />
    <title>FIRE</title>
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Helvetica Neue', Helvetica, Arial, Sans-serif;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        h1 {
            font-size: 20px;
            line-height: 30px;
        }

        h2 {
            font-size: 14px;
            line-height: 20px;
            margin-bottom: 10px;
        }

        a {
            text-decoration: none;
            color: #2dc4b2;
        }

        #console {
            position: absolute;
            width: 520px;
            /* 240px; */
            margin: 10px;
            padding: 10px 20px;
            background-color: white;
        }

        .session {
            margin-bottom: 20px;
        }

        .row {
            height: 12px;
            width: 100%;
        }

        .colors {
            background: linear-gradient(to right, #2dc4b2, #3bb3c3, #669ec4, #8b88b6, #a2719b, #aa5e79);
            margin-bottom: 5px;
        }

        .label {
            width: 15%;
            display: inline-block;
            text-align: center;
        }
    </style>
</head>

<body>
    <div id='map'></div>
    <div id='console'>
        <h1>Patterns of Destruction</h1>
        <p>Data: <a href='https://data.cityofnewyork.us/Public-Safety/NYPD-Motor-Vehicle-Collisions/h9gi-nx95'>Motor
                vehicle
                collision injuries and deaths</a> in NYC, Jan 2016</p>
        <div class='session'>
            <h2>Acreage</h2>
            <div class='row colors'>
            </div>
            <div class='row labels'>
                <div class='label'>0</div>
                <div class='label'>1</div>
                <div class='label'>2</div>
                <div class='label'>3</div>
                <div class='label'>4</div>
                <div class='label'>5+</div>
            </div>
        </div>
        <div class='session' id='sliderbar'>
            <h2>Year: <label id='active-year'>2019</label></h2>
            <input id='slider' class='row' type='range' min='0' max='43' step='1' value='43' />
        </div>
        <div class='session'>
            <h2>Month of year</h2>
            <div class='row' id='filters'>
                <input id='all' type='radio' name='toggle' value='all' checked='checked'>
                <label for='all'>All</label>
                <input id='January' type='radio' name='toggle' value='January'>
                <label for='January'>January</label>
                <input id='February' type='radio' name='toggle' value='February'>
                <label for='February'>February</label>
                <input id='March' type='radio' name='toggle' value='March'>
                <label for='March'>March</label>
                <input id='April' type='radio' name='toggle' value='April'>
                <label for='April'>April</label>
                <input id='May' type='radio' name='toggle' value='May'>
                <label for='May'>May</label>
                <input id='June' type='radio' name='toggle' value='June'>
                <label for='June'>June</label>
                <input id='July' type='radio' name='toggle' value='July'>
                <label for='July'>July</label>
                <input id='August' type='radio' name='toggle' value='August'>
                <label for='August'>August</label>
                <input id='September' type='radio' name='toggle' value='September'>
                <label for='September'>September</label>
                <input id='October' type='radio' name='toggle' value='October'>
                <label for='October'>October</label>
                <input id='November' type='radio' name='toggle' value='November'>
                <label for='November'>November</label>
                <input id='December' type='radio' name='toggle' value='December'>
                <label for='December'>December</label>
            </div>
        </div>
    </div>
</body>

<script src='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js'></script>
<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>

<script>
    // Access Token
    mapboxgl.accessToken =
        'pk.eyJ1IjoiYWxleGJ1Y2szMjgiLCJhIjoiY2szcDZsdmFsMW9rbDNubjMydm9rNGJpMyJ9.05szss9EHEoVBbGYajbPZA';

    // Map!!!
    var map = new mapboxgl.Map({
        container: 'map', // container element id
        style: 'mapbox://styles/mapbox/light-v10',
        center: [-118.646, 43.0434], // initial map center in [lon, lat]
        zoom: 4.66
    });

    map.on('load', function () {
        //    var filterYear = ['==', 'year', year]
        var filterYear = ['==', ['number', ['get', 'year']], 2019];
        var filterMonth = ['!=', ['string', ['get', 'month']], 'placeholder'];

        d3.json(
            // 'rawData/collisions1601.geojson',
            // 'rawData/classD.geojson',
            'data/bothDatesClean.geojson',
            function (err, data) {
                if (err) throw err;

                // Create a year property value based on IgntDate (time)
                // used to filter against.
                data.features = data.features.map(function (d) {
                    d.properties.year = new Date(d.properties.IgntDate)
                        .getFullYear();
                    return d;
                });

                map.addSource('fires', {
                    type: 'geojson',
                    data: data
                });

                console.log(data)

                map.addLayer({
                    id: 'firePolys',
                    type: 'fill',
                    source: 'fires',
                    paint: {
                        'fill-color': [
                            'interpolate',
                            ['linear'],
                            ['number', ['get', 'Acres']], // 'Casualty'
                            900, '#FCA107',
                            900000, '#7F3121'
                        ],
                        'fill-opacity': 0.8
                    },
                    filter: ['==', ['number', ['get', 'year']], 2019] // 'Hour' 12
                });


                // SLIDER
                document.getElementById('slider').addEventListener('input', function (e) {
                    var year = parseInt(e.target.value, 10);

                    const fireYears = [1976,
                        1977,
                        1978,
                        1979,
                        1980,
                        1981,
                        1982,
                        1983,
                        1984,
                        1985,
                        1986,
                        1987,
                        1988,
                        1989,
                        1990,
                        1991,
                        1992,
                        1993,
                        1994,
                        1995,
                        1996,
                        1997,
                        1998,
                        1999,
                        2000,
                        2001,
                        2002,
                        2003,
                        2004,
                        2005,
                        2006,
                        2007,
                        2008,
                        2009,
                        2010,
                        2011,
                        2012,
                        2013,
                        2014,
                        2015,
                        2016,
                        2017,
                        2018,
                        2019
                    ];

                    var sliderYear = fireYears[year]

                    console.log(sliderYear)

                    // update the map
                    filterYear = ['==', ['number', ['get', 'year']], sliderYear];
                    map.setFilter('firePolys', ['all', filterYear, filterMonth]);

                    // update text in the UI
                    document.getElementById('active-year').innerText = sliderYear;
                });


                // RADIO BUTTONS
                document
                    .getElementById('filters')
                    .addEventListener('change', function (e) {
                        var month = (e.target.value);

                        console.log(month)

                        // update the map filter
                        if (month === 'all') {
                            filterMonth = ['!=', ['string', ['get', 'IgntMonth']], 'placeholder'];
                        } else if (month === 'January') {
                            filterMonth = [
                                'match',
                                ['get', 'IgntMonth'],
                                ['January'],
                                false,
                                true
                            ];
                        } else if (month === 'February') {
                            filterMonth = [
                                'match',
                                ['get', 'IgntMonth'],
                                ['February'],
                                false,
                                true
                            ];
                        } else if (month === 'March') {
                            filterMonth = [
                                'match',
                                ['get', 'IgntMonth'],
                                ['March'],
                                false,
                                true
                            ];
                        } else if (month === 'April') {
                            filterMonth = [
                                'match',
                                ['get', 'IgntMonth'],
                                ['April'],
                                false,
                                true
                            ];
                        } else if (month === 'May') {
                            filterMonth = [
                                'match',
                                ['get', 'IgntMonth'],
                                ['May'],
                                false,
                                true
                            ];
                        } else if (month === 'June') {
                            filterMonth = [
                                'match',
                                ['get', 'IgntMonth'],
                                ['June'],
                                false,
                                true
                            ];
                        } else if (month === 'July') {
                            filterMonth = [
                                'match',
                                ['get', 'IgntMonth'],
                                ['July'],
                                false,
                                true
                            ];
                        } else if (month === 'August') {
                            filterMonth = [
                                'match',
                                ['get', 'IgntMonth'],
                                ['August'],
                                false,
                                true
                            ];
                        } else if (month === 'September') {
                            filterMonth = [
                                'match',
                                ['get', 'IgntMonth'],
                                ['September'],
                                false,
                                true
                            ];
                        } else if (month === 'October') {
                            filterMonth = [
                                'match',
                                ['get', 'IgntMonth'],
                                ['October'],
                                false,
                                true
                            ];
                        } else if (month === 'November') {
                            filterMonth = [
                                'match',
                                ['get', 'IgntMonth'],
                                ['November'],
                                false,
                                true
                            ];
                        } else if (month === 'December') {
                            filterMonth = [
                                'match',
                                ['get', 'IgntMonth'],
                                ['December'],
                                true,
                                false
                            ];
                        } else {
                            console.log('error');
                        }
                        map.setFilter('firePolys', ['all', filterMonth, filterYear]);
                    });

                // When a click event occurs on a feature in the states layer, open a popup at the
                // location of the click, with description HTML from its properties.
                map.on('click', 'firePolys', function (e) {

                    var acresNum = e.features[0].properties.Acres
                    var acresFixed = acresNum.toFixed(2);

                    // console.log(acresFixed)

                    new mapboxgl.Popup()
                        .setLngLat(e.lngLat)
                        .setHTML(`<b>Fire Name:</b> ${e.features[0].properties.FireName}<br><b>Fire
                        Cause:</b> ${e.features[0].properties.FireCause}<br><b>Fire
                        Size:</b> ${acresFixed} Acres<br><b>Fire Year:</b>
                        ${e.features[0].properties.FireYear}<br><b>Ignition Month:</b>
                        ${e.features[0].properties.IgntMonth}<br><b>Control Month:</b>
                        ${e.features[0].properties.ContrlMonth}`)
                        .addTo(map);
                });

                // Change the cursor to a pointer when the mouse is over the states layer.
                map.on('mouseenter', 'firePolys', function () {
                    map.getCanvas().style.cursor = 'pointer';
                });

                // Change it back to a pointer when it leaves.
                map.on('mouseleave', 'firePolys', function () {
                    map.getCanvas().style.cursor = '';
                });

            });
    });
</script>

</html>